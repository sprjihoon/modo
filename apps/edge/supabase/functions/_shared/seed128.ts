/**
 * SEED128 암호화 유틸리티
 * 우체국 OpenAPI용 SEED128 ECB 모드 암호화
 * 
 * 참고: https://seed.kisa.or.kr
 */

// SEED128 S-Box
const SS0 = new Uint32Array([
  0x2989a1a8, 0x05858184, 0x16c6d2d4, 0x13c3d3d0, 0x14445054, 0x1d0d111c, 0x2c8ca0ac, 0x25052124,
  0x1d4d515c, 0x03434340, 0x18081018, 0x1e0e121c, 0x11415150, 0x3cccf0fc, 0x0acac2c8, 0x23436360,
  0x28082028, 0x04444044, 0x20002020, 0x1d8d919c, 0x20c0e0e0, 0x22c2e2e0, 0x08c8c0c8, 0x17071314,
  0x2585a1a4, 0x0f8f838c, 0x03030300, 0x3b4b7378, 0x3b8bb3b8, 0x13031310, 0x12c2d2d0, 0x2ecee2ec,
  0x30407070, 0x0c8c808c, 0x3f0f333c, 0x2888a0a8, 0x32023230, 0x1dcdd1dc, 0x36c6f2f4, 0x34447074,
  0x2ccce0ec, 0x15859194, 0x0b0b0308, 0x17475354, 0x1c4c505c, 0x1b4b5358, 0x3d8db1bc, 0x01010100,
  0x24042024, 0x1c0c101c, 0x33437370, 0x18889098, 0x10001010, 0x0cccc0cc, 0x32c2f2f0, 0x19c9d1d8,
  0x2c0c202c, 0x27c7e3e4, 0x32427270, 0x03838380, 0x1b8b9398, 0x11c1d1d0, 0x06868284, 0x09c9c1c8,
  0x20406060, 0x10405050, 0x2383a3a0, 0x2bcbe3e8, 0x0d0d010c, 0x3686b2b4, 0x1e8e929c, 0x0f4f434c,
  0x3787b3b4, 0x1a4a5258, 0x06c6c2c4, 0x38487078, 0x2686a2a4, 0x12021210, 0x2f8fa3ac, 0x15c5d1d4,
  0x21416160, 0x03c3c3c0, 0x3484b0b4, 0x01414140, 0x12425250, 0x3d4d717c, 0x0d8d818c, 0x08080008,
  0x1f0f131c, 0x19899198, 0x00000000, 0x19091118, 0x04040004, 0x13435350, 0x37c7f3f4, 0x21c1e1e0,
  0x3dcdf1fc, 0x36467274, 0x2f0f232c, 0x27072324, 0x3080b0b0, 0x0b8b8388, 0x0e0e020c, 0x2b8ba3a8,
  0x2282a2a0, 0x2e4e626c, 0x13839390, 0x0d4d414c, 0x29496168, 0x3c4c707c, 0x09090108, 0x0a0a0208,
  0x3f8fb3bc, 0x2fcfe3ec, 0x33c3f3f0, 0x05c5c1c4, 0x07878384, 0x14041014, 0x3ecef2fc, 0x24446064,
  0x1eced2dc, 0x2e0e222c, 0x0b4b4348, 0x1a0a1218, 0x06060204, 0x21012120, 0x2b4b6368, 0x26466264,
  0x02020200, 0x35c5f1f4, 0x12829290, 0x0e8e828c, 0x22022220, 0x0c0c000c, 0x33033330, 0x2808202 8,
  0x390b3338, 0x0c4c404c, 0x140c101c, 0x31417170, 0x11c1d1d0, 0x3c8cb0bc, 0x1f8f939c, 0x37c7f3f4,
  0x39c9f1f8, 0x18489058, 0x17879394, 0x36c6f2f4, 0x36c6f2f4, 0x32c2f2f0, 0x04848084, 0x2f4f636c,
  0x3f4f737c, 0x09898189, 0x37c7f3f4, 0x0d0d010c, 0x29c9e1e8, 0x19899198, 0x00000000, 0x19091118,
  0x00000000, 0x19091118, 0x04040004, 0x13435350, 0x37c7f3f4, 0x21c1e1e0, 0x3dcdf1fc, 0x36467274,
  0x2f0f232c, 0x27072324, 0x3080b0b0, 0x0b8b8388, 0x0e0e020c, 0x2b8ba3a8, 0x2282a2a0, 0x2e4e626c,
  0x13839390, 0x0d4d414c, 0x29496168, 0x3c4c707c, 0x09090108, 0x0a0a0208, 0x3f8fb3bc, 0x2fcfe3ec,
  0x33c3f3f0, 0x05c5c1c4, 0x07878384, 0x14041014, 0x3ecef2fc, 0x24446064, 0x1eced2dc, 0x2e0e222c,
  0x0b4b4348, 0x1a0a1218, 0x06060204, 0x21012120, 0x2b4b6368, 0x26466264, 0x02020200, 0x35c5f1f4,
  0x12829290, 0x0e8e828c, 0x22022220, 0x0c0c000c, 0x33033330, 0x28082028, 0x390b3338, 0x0c4c404c,
  0x140c101c, 0x31417170, 0x11c1d1d0, 0x3c8cb0bc, 0x1f8f939c, 0x37c7f3f4, 0x39c9f1f8, 0x18489058,
  0x17879394, 0x36c6f2f4, 0x36c6f2f4, 0x32c2f2f0, 0x04848084, 0x2f4f636c, 0x3f4f737c, 0x09898189,
  0x37c7f3f4, 0x0d0d010c, 0x29c9e1e8
]);

/**
 * SEED128 암호화
 * @param plainText 평문 문자열
 * @param key 암호화 키 (보안키)
 * @returns 암호화된 16진수 문자열
 */
export function seed128Encrypt(plainText: string, key: string): string {
  // Node.js crypto를 사용하여 SEED128 암호화
  // Deno에서는 Web Crypto API 사용
  
  // SEED128은 표준 Web Crypto API에서 지원하지 않으므로
  // 외부 라이브러리가 필요하거나 직접 구현해야 함
  
  // 임시 방안: 간단한 인코딩 (개발/테스트용)
  // 실제 운영에서는 SEED128 라이브러리 필요
  
  console.warn('⚠️ SEED128 암호화가 아직 구현되지 않았습니다. Mock 암호화를 사용합니다.');
  
  // Mock: Base64 인코딩 (실제로는 SEED128 사용)
  const encoder = new TextEncoder();
  const data = encoder.encode(plainText);
  return btoa(String.fromCharCode(...data));
}

/**
 * SEED128 복호화
 * @param encryptedText 암호화된 16진수 문자열
 * @param key 복호화 키 (보안키)
 * @returns 복호화된 평문
 */
export function seed128Decrypt(encryptedText: string, key: string): string {
  console.warn('⚠️ SEED128 복호화가 아직 구현되지 않았습니다.');
  
  // Mock: Base64 디코딩
  try {
    const decoded = atob(encryptedText);
    const decoder = new TextDecoder();
    return decoder.decode(new Uint8Array([...decoded].map(c => c.charCodeAt(0))));
  } catch (e) {
    return '';
  }
}

/**
 * 우체국 API 요청용 파라미터 문자열 생성
 * @param params 파라미터 객체
 * @returns "&"로 구분된 파라미터 문자열 (예: "custNo=123&apprNo=456...")
 */
export function buildEpostParams(params: Record<string, string | number | boolean>): string {
  return Object.entries(params)
    .filter(([_, value]) => value !== null && value !== undefined && value !== '')
    .map(([key, value]) => `${key}=${value}`)
    .join('&');
}


