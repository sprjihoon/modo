# 🔄 네트워크 중단 테스트 (TUS Protocol 검증)

## 목적
TUS Protocol의 핵심 기능인 "재개 가능한 업로드"를 테스트합니다.

---

## 테스트 방법

### Step 1: 대용량 파일 준비
- 100MB 이상의 영상 파일 준비
- 업로드 시간이 충분히 길어야 테스트 가능

---

### Step 2: 업로드 시작
1. 브라우저에서 http://localhost:3002 접속
2. 주문 상세 페이지로 이동
3. "입고 영상 업로드" 또는 "출고 영상 업로드" 클릭
4. 100MB 파일 선택
5. 업로드 시작

---

### Step 3: 진행률 50% 지점에서 네트워크 끊기

**방법 1: Chrome DevTools (권장)**
1. F12 > Network 탭 열기
2. 진행률이 **50% 정도** 되면
3. **"Offline" 체크박스 클릭**
4. 네트워크가 끊김

**방법 2: WiFi 끄기**
1. 진행률 50% 지점에서
2. Mac: WiFi 아이콘 클릭 → WiFi 끄기
3. Windows: 비행기 모드 켜기

---

### Step 4: 10초 대기
- 진행률 바가 멈춤
- 콘솔에 에러 메시지 표시 가능 (정상)
- "업로드 일시 정지" 또는 "재시도 중..." 메시지

---

### Step 5: 네트워크 복구

**방법 1: Chrome DevTools**
1. **"Offline" 체크박스 해제**
2. 네트워크 복구

**방법 2: WiFi 켜기**
1. WiFi 다시 켜기

---

### Step 6: 자동 재개 확인 ⭐

**예상 동작:**
- ✅ 진행률이 **50%부터 계속됨** (처음부터 다시 X)
- ✅ 자동으로 업로드 재개
- ✅ 100%까지 정상 완료

**콘솔 로그:**
```
📤 Upload progress: 45.0%
📤 Upload progress: 50.0%
❌ Network error (정상)
🔄 Retrying in 3 seconds...
✅ Connection restored
📤 Upload progress: 50.5%  // ← 50%부터 재개!
📤 Upload progress: 75.0%
📤 Upload progress: 100.0%
✅ Upload completed successfully!
```

---

## ✅ 성공 기준

### TUS Protocol이 제대로 작동하는 경우:
- [x] 네트워크 중단 시 업로드 일시 정지
- [x] 네트워크 복구 시 자동 재개
- [x] **진행률이 중단된 지점부터 계속됨**
- [x] 최종적으로 업로드 성공

### 기존 시스템 (Direct Upload):
- [ ] 네트워크 중단 시 에러 발생
- [ ] 업로드 실패
- [ ] **처음부터 다시 시작해야 함**

---

## 🎯 예상 결과

**기존 시스템:**
```
업로드 시작 (0%) → 50% → [네트워크 끊김] → 실패 ❌
→ 다시 처음부터 (0%) → 100% (총 시간: 2배)
```

**개선된 시스템 (TUS):**
```
업로드 시작 (0%) → 50% → [네트워크 끊김] → 일시 정지
→ [네트워크 복구] → 50%부터 재개 → 100% ✅ (총 시간: 1.5배)
```

---

## 🐛 문제 발생 시

### 1. 처음부터 다시 시작됨
**원인:** TUS Protocol이 비활성화됨

**확인:**
```bash
# .env.local 확인
cat modo/apps/admin/.env.local | grep NEXT_PUBLIC_USE_TUS_UPLOAD
```

**예상:** `NEXT_PUBLIC_USE_TUS_UPLOAD=true`

**해결:**
```bash
# 서버 재시작
# Ctrl + C
npm run dev
```

---

### 2. 네트워크 복구 후에도 재개 안 됨
**원인:** 서버 측 TUS 엔드포인트 문제

**확인:** 콘솔 로그에서 에러 메시지 확인

**해결:** 
- API Route 코드 확인
- `uploadToCloudflareStreamTus` 함수 호출 확인

---

### 3. "Offline" 체크박스가 작동 안 함
**해결:** WiFi를 직접 끄고 테스트

---

## 📊 테스트 결과 기록

| 테스트 | 결과 | 비고 |
|--------|------|------|
| 네트워크 중단 시 일시 정지 | ☐ Pass ☐ Fail | |
| 네트워크 복구 시 자동 재개 | ☐ Pass ☐ Fail | |
| 50%부터 재개됨 (0% X) | ☐ Pass ☐ Fail | |
| 최종 업로드 성공 | ☐ Pass ☐ Fail | |

---

**이 테스트가 통과하면, TUS Protocol이 완벽하게 작동하는 것입니다!** 🎉

**버전:** 1.0  
**작성일:** 2025-12-18

