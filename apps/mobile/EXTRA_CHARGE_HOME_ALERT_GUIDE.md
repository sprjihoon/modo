# 📱 홈 화면 추가결제 알림 가이드

## 🎯 개요

푸시 알림을 놓치거나 무시한 경우를 대비해 **홈 화면에 추가결제 알림 배너**를 표시합니다.
고객이 앱을 열면 즉시 추가결제 요청을 확인할 수 있습니다.

---

## ✨ 주요 기능

### 1️⃣ **홈 화면 상단 알림 배너**
```
┌──────────────────────────────────────┐
│  장지훈님 반가워요!                   │
│  비대면 의류 수선 서비스입니다.       │
├──────────────────────────────────────┤
│  ┌────────────────────────────────┐  │
│  │ 💳 추가 결제 요청         ➡️  │  │ ← 🆕 알림 배너
│  │                                │  │
│  │ ORD-2024-001에 추가 작업이    │  │
│  │ 필요합니다                     │  │
│  │                                │  │
│  │ 추가 금액: 15,000원           │  │
│  └────────────────────────────────┘  │
├──────────────────────────────────────┤
│  [배너 슬라이더]                     │
│  ...                                  │
└──────────────────────────────────────┘
```

**특징:**
- 🎨 눈에 띄는 주황색 그라데이션 배너
- 💰 추가 금액 명시
- 🔔 클릭 시 주문 상세로 바로 이동
- ✨ PENDING_CUSTOMER 상태일 때만 표시

---

### 2️⃣ **내 주문 섹션 강조 표시**
```
┌──────────────────────────────────────┐
│  내 주문                   전체보기 ➡ │
├──────────────────────────────────────┤
│  ┌────────────────────────────────┐  │
│  │  💳!  [추가결제] [입고완료]    │  │ ← 🆕 배지 추가
│  │      2025.12.19                │  │
│  │                                │  │
│  │  전체밸트 줄임 - 소매수선      │  │
│  │  ₩22,000                       │  │
│  │                          ➡️    │  │
│  └────────────────────────────────┘  │
│                                      │
│  [전체 주문 보기]                    │
└──────────────────────────────────────┘
```

**강조 요소:**
- 🔴 아이콘 우측 상단에 느낌표 배지
- 🧡 주황색 테두리 (2px)
- 💳 "추가결제" 배지 우선 표시
- 🎨 주황색 음영 효과

---

## 📂 파일 구조

```
lib/features/home/
  presentation/
    pages/
      home_page.dart               ← 홈 화면 (수정됨)
    widgets/
      extra_charge_alert_banner.dart  ← 🆕 알림 배너 위젯
```

---

## 🔍 동작 원리

### **1. 주문 목록 조회**
```dart
Future<List<Map<String, dynamic>>> _getCachedOrders() async {
  final orders = await _orderService.getMyOrders();
  return orders;
}
```

### **2. PENDING_CUSTOMER 상태 필터링**
```dart
final pendingOrder = orders.firstWhere(
  (order) => order['extra_charge_status'] == 'PENDING_CUSTOMER',
  orElse: () => {},
);
```

### **3. 알림 배너 표시**
```dart
if (pendingOrder.isNotEmpty) {
  return ExtraChargeAlertBanner(orderData: pendingOrder);
}
```

---

## 🎨 UI 컴포넌트

### **ExtraChargeAlertBanner**

```dart
ExtraChargeAlertBanner(
  orderData: {
    'id': 'uuid',
    'order_number': 'ORD-2024-001',
    'extra_charge_data': {
      'managerPrice': 15000,
      'managerNote': '단추 교체 필요',
    },
  },
)
```

**속성:**
- `orderData`: 주문 전체 데이터 (Map)
- 클릭 시 `/orders/{orderId}` 로 이동

**디자인:**
- 배경: 주황색 → 진한 주황색 그라데이션
- 아이콘: 💳 결제 아이콘 (흰색)
- 텍스트: 흰색, 굵은 글씨
- 그림자: 주황색 음영 (12px blur)

---

## 🚀 사용자 시나리오

### **시나리오 1: 푸시 알림 탭**
```
1. [푸시 알림 수신]
   "추가 결제 요청 - 15,000원"
   
2. [알림 탭]
   → 앱 실행
   → 주문 상세 화면으로 자동 이동
   
3. [추가결제 카드 표시]
   → 고객이 선택 (결제/진행/반송)
```

---

### **시나리오 2: 푸시 알림 무시/스킵**
```
1. [푸시 알림 수신]
   "추가 결제 요청 - 15,000원"
   
2. [알림 무시/닫기]
   → 나중에 앱 실행
   
3. [홈 화면 진입]
   → 🆕 상단에 주황색 배너 표시
   "💳 추가 결제 요청
    ORD-2024-001에 추가 작업이 필요합니다
    추가 금액: 15,000원"
   
4. [배너 클릭]
   → 주문 상세 화면으로 이동
   
5. [추가결제 카드에서 선택]
   → 결제/진행/반송
```

---

### **시나리오 3: 내 주문에서 확인**
```
1. [푸시 알림 무시]
   
2. [홈 화면 진입]
   → 상단 배너 표시 (스크롤하면 사라짐)
   
3. [내 주문 섹션 확인]
   → 주문 카드에 강조 표시:
     - 주황색 테두리
     - "추가결제" 배지
     - 느낌표 아이콘
   
4. [주문 카드 클릭]
   → 주문 상세 화면으로 이동
```

---

## 🔄 상태 관리

### **추가결제 상태별 표시**

| 상태 | 홈 배너 | 주문 카드 강조 | 주문 상세 카드 |
|------|---------|---------------|---------------|
| **NONE** | ❌ | ❌ | ❌ |
| **PENDING_MANAGER** | ❌ | ❌ | ❌ |
| **PENDING_CUSTOMER** | ✅ 표시 | ✅ 강조 | ✅ 표시 |
| **COMPLETED** | ❌ | ❌ | ❌ |
| **SKIPPED** | ❌ | ❌ | ❌ |
| **RETURN_REQUESTED** | ❌ | ❌ | ❌ |

**핵심:**
- `PENDING_CUSTOMER` 상태에서만 홈 화면에 알림 표시
- 고객이 액션을 취하면 자동으로 사라짐

---

## 🎯 UX 개선 효과

### **Before (기존)**
```
❌ 푸시 알림을 놓치면 알 수 없음
❌ 주문 상세에 들어가야만 확인 가능
❌ 어떤 주문인지 찾기 어려움
```

### **After (개선)**
```
✅ 홈 화면 진입 시 즉시 확인
✅ 명확한 시각적 피드백
✅ 클릭 한 번에 해당 주문으로 이동
✅ 놓칠 수 없는 배너 + 강조 표시
```

---

## 📊 표시 우선순위

1. **홈 화면 상단 배너** (최고 우선순위)
   - 인사말 바로 아래
   - 스크롤 전에 보임

2. **내 주문 카드 강조**
   - 주황색 테두리
   - 배지 표시

3. **주문 상세 화면 카드**
   - 화면 최상단
   - 오렌지색 카드

---

## 🔒 보안

- ✅ `getMyOrders()`로 본인 주문만 조회
- ✅ RLS 정책으로 타인 주문 차단
- ✅ 주문 ID로만 이동 (민감정보 미노출)

---

## 🐛 트러블슈팅

### **배너가 표시되지 않음**
```
원인: extra_charge_status가 PENDING_CUSTOMER가 아님

해결:
1. Supabase에서 주문 상태 확인:
   SELECT id, order_number, extra_charge_status 
   FROM orders 
   WHERE user_id = 'your-user-id';

2. 테스트용 상태 변경:
   UPDATE orders 
   SET extra_charge_status = 'PENDING_CUSTOMER'
   WHERE id = 'test-order-id';
```

### **배너 클릭 후 화면 이동 안 됨**
```
원인: order ID가 잘못됨

해결:
- orderData['id']가 올바른 UUID인지 확인
- GoRouter 경로 확인: /orders/:orderId
```

---

## ✅ 체크리스트

배포 전 확인사항:

- [x] `extra_charge_alert_banner.dart` 생성
- [x] `home_page.dart`에 배너 통합
- [x] "내 주문" 카드에 강조 표시 추가
- [x] PENDING_CUSTOMER 상태 필터링
- [x] 클릭 시 주문 상세로 이동
- [ ] 실제 데이터로 테스트
- [ ] 다양한 화면 크기에서 테스트
- [ ] 여러 건의 PENDING_CUSTOMER 주문 처리 확인

---

## 📞 추가 개선 가능성

1. **여러 건의 추가결제 요청**
   - 현재: 첫 번째 주문만 표시
   - 개선: 여러 주문을 슬라이더로 표시

2. **알림 배너 닫기 버튼**
   - 현재: 항상 표시
   - 개선: 사용자가 임시로 숨길 수 있는 옵션

3. **애니메이션 효과**
   - 현재: 정적 표시
   - 개선: 페이드인 애니메이션, 펄스 효과

---

## 🎉 결론

이제 고객은 **푸시 알림을 놓쳐도** 홈 화면에서 추가결제 요청을 명확하게 확인할 수 있습니다!

**3단계 알림 시스템:**
1. 📲 푸시 알림 (즉시)
2. 🏠 홈 배너 (앱 진입 시)
3. 📦 주문 카드 강조 (스크롤 후)

**놓칠 수 없는 UX 완성!** ✨

